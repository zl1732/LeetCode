#
# @lc app=leetcode.cn id=518 lang=python3
# @lcpr version=30202
#
# [518] é›¶é’±å…‘æ¢ II
#

# @lc code=start
class Solution:
    def change(self, amount: int, coins: List[int]) -> int:
        self.res = 0
        self.coins = coins
        self.memo_fail = set()  # åªè®°å½•å¤±è´¥ä½ç½®
        self.dfs(amount, 0, 0)
        return self.res

    def dfs(self, amount: str, i: int, start: int) -> bool:
        if i == amount:
            self.res += 1
            return True
        """
        memo_fail åªç”¨ i ä½œä¸º keyï¼Œå‰ªæè¿‡ä¸¥
        ä½ æŠŠæ‰€æœ‰ä»æŸä¸ªå·²å¤±è´¥çš„é‡‘é¢ i å¼€å§‹çš„è·¯å¾„éƒ½å‰ªæ‰ï¼Œä½†å®é™…ä¸ŠåŒä¸€ä¸ª i åœ¨ä¸åŒçš„ start ä¸‹å¯èƒ½æœ‰ä¸åŒçš„å‡ºè·¯ã€‚
        éœ€è¦æŠŠ (i, start) ä¸€èµ·ä½œä¸ºå‰ªæçš„ keyï¼Œæ‰èƒ½æ›´ç²¾ç¡®åœ°è®°â€œä»é‡‘é¢ i ä¸”å‰©ä½™å¸ç§ç´¢å¼• â‰¥ start æ—¶æ˜¯å¤±è´¥çš„â€ã€‚
        
        ä¸ºä»€ä¹ˆ140å¯ä»¥è¿™ä¹ˆå‰ªæ
            âœ… 140 é¢˜ä¸­ï¼š
            åŒä¸€ä¸ªä½ç½® iï¼Œåªè¦è®°ä½æ˜¯å¦èƒ½ä» i å‡ºå‘æˆåŠŸåˆ’åˆ†æ•´ä¸ªå­—ç¬¦ä¸²å°±å¤Ÿäº†ã€‚
            æ‰€ä»¥åªéœ€ç”¨ i åš key å­˜ memo[i] = False å°±èƒ½å‰ªæã€‚

            ç‰¹æ€§ï¼š
            å¯¹äºä½ç½® iï¼š
                å¦‚æœä» i å‡ºå‘ï¼Œæ‰€æœ‰å­å­—ç¬¦ä¸²éƒ½ä¸èƒ½è¢«åˆ†è¯ï¼Œé‚£ä» i å¼€å§‹çš„è·¯å¾„æ°¸è¿œå¤±è´¥ï¼›
                ä¸ç®¡æ˜¯è°è°ƒç”¨ dp(i)ï¼Œç»“æœéƒ½ä¸€æ ·ã€‚
            æ‰€ä»¥ memo[i] åªéœ€è¦ä¾èµ– iï¼Œæ˜¯â€œæ— é¢å¤–çŠ¶æ€â€çš„ã€‚

            å…³é”®ï¼šå¯¹äºåŒä¸€ä¸ªä½ç½® iï¼Œæ— è®ºæ˜¯å“ªä¸ªé€’å½’è·¯å¾„èµ°åˆ° iï¼Œå®ƒåé¢çš„æ‰€æœ‰ç»“æœéƒ½æ˜¯ä¸€æ ·çš„ã€‚

        
        ä¸ºä»€ä¹ˆ518ä¸èƒ½è¿™æ ·å‰ªæ
            âŒ 518 é¢˜ä¸­ï¼š
            åŒä¸€ä¸ªé‡‘é¢ currï¼Œå¦‚æœå½“å‰å¯é€‰å¸ç§èµ·ç‚¹ start ä¸ä¸€æ ·ï¼Œç»“æœä¹Ÿå¯èƒ½ä¸ä¸€æ ·ã€‚
            æ‰€ä»¥ä¸èƒ½åªç”¨ curr å‰ªæï¼Œè€Œæ˜¯å¿…é¡»è®°ä½ (curr, start)ã€‚

            å…³é”®ï¼šLeetCode 518 ä¸­ï¼Œæ˜¯å¦èƒ½å‡‘å‡ºé‡‘é¢ iï¼Œä¸ä»…å–å†³äºé‡‘é¢ iï¼Œè¿˜å–å†³äºä½ å…è®¸ä½¿ç”¨å“ªäº›ç¡¬å¸ï¼ˆä¹Ÿå°±æ˜¯ start ä½ç½®ï¼‰
            
            âœ… æ›´ç›´è§‚çš„ä¾‹å­
            coins = [1, 2, 5]ï¼Œamount = 5ï¼š
            å¦‚æœä½ ä» curr=3 å‡ºå‘ï¼š
                å½“ start=0ï¼Œä½ å¯ä»¥é€‰ 1ï¼Œå†é€‰ 1ï¼Œåˆæ³•ã€‚
                å½“ start=2ï¼Œåªèƒ½ç”¨ 5ï¼Œå°±è¶…é¢äº†ã€‚
            æ‰€ä»¥ä½ ä¸èƒ½åªç”¨ curr=3 å‰ªæï¼

        | é—®é¢˜                | æ˜¯å¦èƒ½åªç”¨ä¸€ä¸ª index ä½œä¸ºå‰ªæ keyï¼Ÿ | è§£é‡Š            |
        | ------------------ | -----------------------------   | ------------- |
        | 140 Word Break II  | âœ… å¯ä»¥åªç”¨ `i`                   | çŠ¶æ€åªä¾èµ–å½“å‰ä½ç½®     |
        | 518 Coin Change II | âŒ éœ€è¦ `(curr, start)`          | çŠ¶æ€ä¾èµ–é‡‘é¢å’Œå‰©ä½™å¸ç§èŒƒå›´ |

        âœ… æ‰€ä»¥å‰ªææˆç«‹çš„å……è¦æ¡ä»¶æ˜¯ï¼š
        å­é—®é¢˜çš„ç»“æœåªå’Œ i æœ‰å…³ï¼Œä¸ä¾èµ–å‰é¢è·¯å¾„çš„å…¶ä»–é€‰æ‹©ã€‚
        """
        # if i in self.memo_fail:
        #     return False

        success = False
        for start in range(start, len(self.coins)):
            coin = self.coins[start]
            if i + coin <= amount:
                """
                start + 1â
                è¿™æ ·å°±æŠŠä¸‹æ¬¡æœç´¢çš„ start å¾€åç§»äº†ä¸€ä½ï¼Œç¦æ­¢é‡å¤ä½¿ç”¨å½“å‰å¸ç§ã€‚
                """
                if self.dfs(amount, i + coin, start):  # å°½ç®¡æˆåŠŸï¼Œä¹Ÿç»§ç»­å°è¯•å…¶å®ƒç»„åˆ
                    success = True

        if not success:
            self.memo_fail.add(i)  # å‰ªæï¼šè¿™ä¸ªä½ç½®èµ·æ­¥çš„è·¯å¾„å…¨å¤±è´¥

        return success
    
"""
ä¾ç„¶é€šè¿‡ä¸äº†æ—¶é—´é™åˆ¶ï¼Œè¿™ä¸ªé¢˜ä¸æ˜¯ç”¨å›æº¯è§£æ³•
14/30 cases passed (N/A)
"""
class Solution:
    def change(self, amount: int, coins: List[int]) -> int:
        self.res = 0
        self.coins = coins
        self.memo_fail = set()  # è®°å½•å¤±è´¥çš„ (i, start) çŠ¶æ€
        self.dfs(amount, 0, 0)
        return self.res

    def dfs(self, amount: int, i: int, start: int) -> bool:
        if i == amount:
            self.res += 1
            return True
        # æ”¹ä¸º2å…ƒç»„
        if (i, start) in self.memo_fail or i > amount:
            return False

        success = False
        for idx in range(start, len(self.coins)):
            coin = self.coins[idx]
            if i + coin <= amount:
                # å…è®¸é‡å¤ä½¿ç”¨å½“å‰ coinï¼Œæ‰€ä»¥ä»ç„¶ä¼  idx
                if self.dfs(amount, i + coin, idx):
                    success = True

        if not success:
            self.memo_fail.add((i, start))  # ç²¾ç¡®å‰ªæï¼šå½“å‰çŠ¶æ€æ— è§£

        return success

"""
GPTç­”æ¡ˆ 29/30 cases passed (N/A)
åŒºåˆ«ä¸€ï¼šè¿”å›å€¼ç»“æ„ vs å…¨å±€è®¡æ•°å™¨ç»“æ„
âœ… æˆ‘çš„å†™æ³•ï¼š
ä¸€æ—¦ dfs(3, 0) ç®—å‡ºè¿”å›å€¼ 3ï¼Œå°±å¯ä»¥ç›´æ¥ç¼“å­˜å¤ç”¨ï¼Œæ‰€æœ‰é‡åˆ° (3, 0) çš„åˆ†æ”¯éƒ½ç›´æ¥æ‹¿ç»“æœï¼Œä¸ä¼šå†é€’å½’ä¸‹å»ã€‚

âŒ ä½ çš„å†™æ³•ï¼š
ä½ è™½ç„¶ä¹Ÿç”¨äº† memo_failï¼Œä½†å‰ªæé€»è¾‘æ˜¯ï¼š
    åªè¦æŸä¸ªè·¯å¾„æ²¡æœ‰ä»»ä½•ä¸€ç§æˆåŠŸæ–¹å¼ï¼Œä½ æ‰ä¼šè®°å½•å¤±è´¥ï¼›
    ä¸€æ—¦æœ‰ä¸€ç§æˆåŠŸè·¯å¾„ï¼Œä½ è¿˜ä¼šç»§ç»­å°è¯•æ‰€æœ‰å…¶å®ƒå¯èƒ½ï¼›
    æ‰€ä»¥å³ä½¿ (i, start) ä½ èµ°è¿‡ä¸€æ¬¡æˆåŠŸè·¯å¾„äº†ï¼Œä¸‹æ¬¡ä½ è¿˜ä¼šé‡æ–°å†èµ°ä¸€éï¼Œæ— æ³•å¤ç”¨è®¡æ•°ç»“æœã€‚

âœ… åŒºåˆ«äºŒï¼šå‰ªæç²’åº¦ä¸ä¸€æ ·
æˆ‘çš„å†™æ³•ç”¨ memo[(remain, start)] = ways æ¥å‰ªæï¼Œæ˜¯æ— è®ºè°ƒç”¨è€…æ˜¯è°ï¼Œç›´æ¥å¤ç”¨è®¡æ•°ç»“æœï¼›
ä½ çš„å†™æ³•ç”¨ self.memo_fail.add((i, start))ï¼Œåªèƒ½å‰ªæ‰â€œå¿…ç„¶å¤±è´¥çš„è·¯å¾„â€ï¼Œä½†ä¸èƒ½å‰ªæ‰â€œè™½ç„¶æˆåŠŸä½†æ²¡å¿…è¦å†èµ°çš„è·¯å¾„â€ã€‚


"""
class Solution:
    def change(self, amount: int, coins: List[int]) -> int:
        memo = {}

        def dfs(remain: int, start: int) -> int:
            if remain == 0:
                return 1
            if remain < 0:
                return 0
            if (remain, start) in memo:
                return memo[(remain, start)]

            ways = 0
            for i in range(start, len(coins)):
                ways += dfs(remain - coins[i], i)  # å¯é‡å¤ä½¿ç”¨å½“å‰å¸ç§

            memo[(remain, start)] = ways
            return ways

        return dfs(amount, 0)



"""
ä½¿ç”¨å®Œå…¨èƒŒåŒ…æ€è·¯ï¼š

dp[i][j] = ä½¿ç”¨å‰ i ä¸ªç¡¬å¸ï¼Œå‡‘å‡ºé‡‘é¢ j çš„ç»„åˆæ•°
æ³¨æ„äº‹é¡¹ï¼š
    i ä» 0 åˆ° nï¼Œè¡¨ç¤ºå‰ i ä¸ªç¡¬å¸ï¼ˆç¬¬ i ä¸ªæ˜¯ coins[i-1]ï¼‰
    j ä» 0 åˆ° amountï¼Œè¡¨ç¤ºé‡‘é¢

âœ… çŠ¶æ€è½¬ç§»æ–¹ç¨‹è®²è§£ï¼ˆå…³é”®ï¼‰
dp[i][j] = dp[i-1][j] + dp[i][j - coins[i-1]]
æˆ‘è‡ªå·±ç†è§£ï¼š dp[i-1][j]çš„æ„æ€æ˜¯ä¸ç”¨æ–°çš„ï¼ˆç¬¬iä¸ªï¼‰ç¡¬å¸ï¼Œç»§ç»­ç”¨å‰é¢çš„ç¡¬å¸æ‹¼å‡ºjçš„è¿™éƒ¨åˆ†è§£æ³•
           dp[i][j - coins[i-1]] åŠ äº†æ–°çš„ç¡¬å¸iï¼Œä½†æ˜¯j - coins[i-1]çš„æ„æ€ï¼šæ–°ç¡¬å¸é¢å€¼coins[i-1]
           å³ dp[i][ç›®æ ‡æ€»é¢ - æ–°ç¡¬å¸é¢å€¼]ï¼Œå³ dp[i-1][ç›®æ ‡æ€»é¢ - æ–°ç¡¬å¸é¢å€¼] âŒâŒ è¿™æ˜¯é”™çš„ âŒâŒ

ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥ğŸ”¥
âœ… æ­£ç¡®ç†è§£ dp[i][j - coins[i-1]] æ˜¯ï¼š
    å…è®¸åœ¨æ„é€  [0, j - coins[i-1]] è¿™ä¸ªé‡‘é¢çš„è¿‡ç¨‹ä¸­ä½¿ç”¨ coins[i-1]â€
    dp[i][j - coins[i-1]] æ˜¯å…è®¸ coins[i-1] åœ¨æ•´ä¸ªæ„é€ è¿‡ç¨‹ä¸­é‡å¤å‡ºç°çš„
    å®ƒå¯èƒ½å·²ç»ç”¨äº†è¿™ä¸ªç¡¬å¸ï¼Œç°åœ¨åˆå†ç”¨ä¸€æšæ¥æ„é€  j

âŒ è€Œ dp[i-1][j - coins[i-1]] çš„å«ä¹‰æ˜¯ï¼š
    åœ¨[0, j - coins[i-1]], æ²¡ç”¨ coins[i-1]ï¼Œç›´åˆ°è¿™æ¬¡æ‰ç”¨ä¸€æ¬¡
    æ‰€ä»¥è¿™æ˜¯ 0-1 èƒŒåŒ…çš„è¡Œä¸ºï¼šåªå…è®¸ coins[i-1] å‡ºç°ä¸€æ¬¡ï¼ˆå½“å‰è¿™æ¬¡ï¼‰


âœ… ä½ æ€»ç»“å¾—éå¸¸å¥½ï¼Œæˆ‘æŠŠä½ çš„åŸè¯ç¨ä½œæ¶¦è‰²ï¼Œä¾›ä½ ä¿å­˜ï¼š
    åŸæ¥æˆ‘è¯¯ä»¥ä¸º dp[i][j - coins[i-1]] æ˜¯â€œæˆ‘åˆšåˆšåŠ äº†ä¸€ä¸ª coins[i-1]â€ï¼Œ
    ä½†å…¶å®å®ƒæ›´é‡è¦çš„å«ä¹‰æ˜¯ï¼šâ€œæˆ‘åœ¨æ„é€  j - coins[i-1] çš„è¿‡ç¨‹ä¸­å°±å¯ä»¥å¤šæ¬¡ä½¿ç”¨ coins[i-1]ï¼Œè€Œä¸æ˜¯åªåœ¨æœ€ååŠ ä¸€æ¬¡â€ã€‚
    æ‰€ä»¥ dp[i][j - coins[i-1]] æ˜¯å…è®¸ coins[i-1] å‡ºç°åœ¨æ•´ä¸ªæ„é€ è¿‡ç¨‹ä¸­ä»»æ„ä½ç½®çš„ï¼›
    è€Œ dp[i-1][j - coins[i-1]] æ‰æ˜¯é‚£ç§â€œå‰é¢å®Œå…¨ä¸å‡†ç”¨ coins[i-1]ï¼Œç›´åˆ°è¿™æ¬¡æ‰ç”¨ä¸€æ¬¡â€çš„è¡Œä¸ºï¼Œè¿™æ‰æ˜¯ 0-1 èƒŒåŒ…çš„å«ä¹‰ã€‚


ğŸ§  ä¸€ä¸ªç›´è§‰å›¾ç¤ºï¼š
ä»¥ coins = [1, 2]ï¼Œamount = 4 ä¸ºä¾‹ï¼š
    dp[1][4] è¡¨ç¤ºï¼šç”¨å‰ 1 ä¸ªç¡¬å¸ï¼ˆä¹Ÿå°±æ˜¯åªç”¨ 1 å…ƒï¼‰å‡‘å‡º 4ï¼š
        å¯ä»¥ï¼š1+1+1+1ï¼Œæ‰€ä»¥ dp[1][4] = 1
    dp[2][4] è¡¨ç¤ºï¼šç”¨å‰ 2 ä¸ªç¡¬å¸ï¼ˆ1 å…ƒå’Œ 2 å…ƒï¼‰å‡‘å‡º 4ï¼š
        ä¸ç”¨ 2 å…ƒ â†’ dp[1][4] = 1
        ç”¨ 2 å…ƒ â†’ dp[2][2] = 2ï¼ˆ2+2 æˆ– 1+1+2ï¼‰
â†’ æ‰€ä»¥ dp[2][4] = dp[1][4] + dp[2][2] = 1 + 2 = 3


dp[1][6] = dp[0][6] + dp[1][4]
        = 0 + dp[1][4]
              â†³ = dp[0][4] + dp[1][2]
                     â†³ = dp[0][2] + dp[1][0]
                            â†³ = dp[0][0] = 1

ä½ ä» dp[1][0] ä¸€è·¯â€œé€’æ¨â€è¿‡æ¥ï¼Œæ¯æ¬¡éƒ½æ˜¯åŠ ä¸€ä¸ª 2ï¼Œå…¶å®å°±ç­‰äºä½ åœ¨è€ƒè™‘åŠ 1ä¸ªã€2ä¸ªã€3ä¸ªç¡¬å¸ï¼

âœ… æ‰€ä»¥åªéœ€è¦åŠ ä¸€æ¬¡çš„åŸå› ï¼š
    æ¯ä¸ªå­çŠ¶æ€ä¼šâ€œæ»šåŠ¨åœ°â€æŠŠå‰é¢çš„æƒ…å†µä¸€å±‚å±‚æ¨è¿‡æ¥ï¼Œç­‰æ•ˆäºç©·ä¸¾äº†æ‰€æœ‰ç”¨ n ä¸ªå½“å‰ç¡¬å¸çš„æƒ…å†µï¼

ä½ åœ¨æ›´æ–° dp[i][j] çš„æ—¶å€™ï¼ŒåŠ äº† dp[i][j - coin]ï¼Œè€Œè¿™ä¸ª dp[i][j - coin] æœ¬èº«å·²ç»åŒ…æ‹¬ï¼š
    ç”¨äº† 1 ä¸ª coin çš„ç»„åˆ
    ç”¨äº† 2 ä¸ª coin çš„ç»„åˆ
    ç”¨äº†æ›´å¤š coin çš„ç»„åˆâ€¦

"""


class Solution:
    def change(self, amount: int, coins: List[int]) -> int:
        n = len(coins) # nä¸ªç¡¬å¸
        dp = [[0] * (amount+1) for _ in range(n+1)]

        # base case
        # amount=0 éƒ½æœ‰ä¸€ç§æ–¹æ³•
        for i in range(n+1):
            dp[i][0] = 1
        
        for i in range(1, n+1):
            for j in range(1, amount+1):
                # coin amount current
                cur_coin = coins[i-1]
                # è¶…é‡,åªèƒ½ä¸æ”¾
                if cur_coin > j:
                    dp[i][j] = dp[i-1][j]
                else:
                    # å®Œå…¨èƒŒåŒ…ï¼Œä¸ç”¨ç¡¬å¸+ç”¨ç¡¬å¸
                    dp[i][j] = dp[i-1][j] + dp[i][j-cur_coin]
        return dp[n][amount]

    # å‹ç¼©æ•°ç»„
    def change(self, amount: int, coins: List[int]) -> int:
        n = len(coins)
        dp = [0] * (amount + 1)
        dp[0] = 1  # base caseï¼šå‡‘å‡º 0 çš„æ–¹æ³•åªæœ‰ 1 ç§ï¼ˆå•¥éƒ½ä¸å–ï¼‰

        for i in range(1, n + 1):  # éå†ç¡¬å¸ç§ç±»
            coin = coins[i - 1]
            for j in range(1, amount + 1):  # é‡‘é¢ä» coin åˆ° amountï¼ˆæ­£åºï¼‰
                if coin > i:
                    continue
                else:
                    dp[j] = dp[j] + dp[j - coin]  # å®Œå…¨èƒŒåŒ…ï¼šå¯ä»¥é‡å¤é€‰ï¼Œæ‰€ä»¥ä»ç„¶æ˜¯ dp[j] += ...

        return dp[amount]

  
    # å‹ç¼©æ•°ç»„
    def change(self, amount: int, coins: List[int]) -> int:
        dp = [0] * (amount + 1)
        dp[0] = 1 
        for coin in coins:
            for j in range(coin, amount + 1):
                dp[j] += dp[j - coin]
        return dp[amount]

# @lc code=end



#
# @lcpr case=start
# 5\n[1, 2, 5]\n
# @lcpr case=end

# @lcpr case=start
# 3\n[2]\n
# @lcpr case=end

# @lcpr case=start
# 10\n[10]\n
# @lcpr case=end

#


#
# @lc app=leetcode.cn id=115 lang=python3
# @lcpr version=30201
#
# [115] ä¸åŒçš„å­åºåˆ—
#

"""
## ä»æ’åˆ—é—®é¢˜ç†è§£ï¼Œ tå°±æ˜¯ç›’å­ï¼Œså°±æ˜¯çƒ
è§†è§’ä¸€ï¼Œä» t çš„è§†è§’ç©·ä¸¾
æˆ‘ä»¬çš„åŸé—®é¢˜æ˜¯æ±‚ s[0..] çš„æ‰€æœ‰å­åºåˆ—ä¸­ t[0..] å‡ºç°çš„æ¬¡æ•°ï¼Œé‚£ä¹ˆå¯ä»¥å…ˆçœ‹ t[0] åœ¨ s ä¸­çš„ä»€ä¹ˆä½ç½®ï¼Œå‡è®¾ s[2], s[6] æ˜¯å­—ç¬¦ t[0]ï¼Œé‚£ä¹ˆåŸé—®é¢˜è½¬åŒ–æˆäº†åœ¨ s[3..] å’Œ s[7..] çš„æ‰€æœ‰å­åºåˆ—ä¸­è®¡ç®— t[1..] å‡ºç°çš„æ¬¡æ•°ã€‚

å†™æˆæ¯”è¾ƒåæ•°å­¦çš„å½¢å¼å°±æ˜¯çŠ¶æ€è½¬ç§»æ–¹ç¨‹ï¼š

// å®šä¹‰ï¼šs[i..] çš„å­åºåˆ—ä¸­ t[j..] å‡ºç°çš„æ¬¡æ•°ä¸º dp(s, i, t, j)
dp(s, i, t, j) = SUM( dp(s, k + 1, t, j + 1) where k >= i and s[k] == t[j] )

ï¼ˆé¦–å…ˆï¼Œä½ å¯ä»¥ç«™åœ¨ç›’å­çš„è§†è§’ï¼Œæ¯ä¸ªç›’å­å¿…ç„¶è¦é€‰æ‹©ä¸€ä¸ªçƒã€‚
è¿™æ ·ï¼Œç¬¬ä¸€ä¸ªç›’å­å¯ä»¥é€‰æ‹© n ä¸ªçƒä¸­çš„ä»»æ„ä¸€ä¸ªï¼Œç„¶åä½ éœ€è¦è®©å‰©ä¸‹ k - 1 ä¸ªç›’å­åœ¨ n - 1 ä¸ªçƒä¸­é€‰æ‹©ï¼ˆè¿™å°±æ˜¯å­é—®é¢˜ P(n - 1, k - 1)ï¼‰ï¼š
ï¼‰


è§†è§’äºŒï¼Œä» s çš„è§†è§’ç©·ä¸¾
æˆ‘ä»¬çš„åŸé—®é¢˜æ˜¯è®¡ç®— s[0..] çš„æ‰€æœ‰å­åºåˆ—ä¸­ t[0..] å‡ºç°çš„æ¬¡æ•°ï¼Œå¯ä»¥å…ˆçœ‹çœ‹ s[0] æ˜¯å¦èƒ½åŒ¹é… t[0]ï¼Œå¦‚æœä¸åŒ¹é…ï¼Œé‚£æ²¡å¾—è¯´ï¼ŒåŸé—®é¢˜å°±å¯ä»¥è½¬åŒ–ä¸ºè®¡ç®— s[1..] çš„æ‰€æœ‰å­åºåˆ—ä¸­ t[0..] å‡ºç°çš„æ¬¡æ•°ï¼›

ä½†å¦‚æœ s[0] å¯ä»¥åŒ¹é… t[0]ï¼Œé‚£ä¹ˆåˆæœ‰ä¸¤ç§æƒ…å†µï¼Œè¿™ä¸¤ç§æƒ…å†µæ˜¯ç´¯åŠ çš„å…³ç³»ï¼š

1ã€è®© s[0] åŒ¹é… t[0]ï¼Œé‚£ä¹ˆåŸé—®é¢˜è½¬åŒ–ä¸ºåœ¨ s[1..] çš„æ‰€æœ‰å­åºåˆ—ä¸­è®¡ç®— t[1..] å‡ºç°çš„æ¬¡æ•°ã€‚

2ã€ä¸è®© s[0] åŒ¹é… t[0]ï¼Œé‚£ä¹ˆåŸé—®é¢˜è½¬åŒ–ä¸ºåœ¨ s[1..] çš„æ‰€æœ‰å­åºåˆ—ä¸­è®¡ç®— t[0..] å‡ºç°çš„æ¬¡æ•°ã€‚

ä¸ºå•¥æ˜æ˜ s[0] å¯ä»¥åŒ¹é… t[0]ï¼Œè¿˜ä¸è®©å®ƒä¿©åŒ¹é…å‘¢ï¼Ÿä¸»è¦æ˜¯ä¸ºäº†ç»™ s[0] ä¹‹åçš„å…ƒç´ åŒ¹é…çš„æœºä¼šï¼Œæ¯”å¦‚ s = "aab", t = "ab"ï¼Œå°±æœ‰ä¸¤ç§åŒ¹é…æ–¹å¼ï¼ša_b å’Œ _abã€‚

ï¼ˆå¦å¤–ï¼Œä½ ä¹Ÿå¯ä»¥ç«™åœ¨çƒçš„è§†è§’ï¼Œå› ä¸ºå¹¶ä¸æ˜¯æ¯ä¸ªçƒéƒ½ä¼šè¢«è£…è¿›ç›’å­ï¼Œæ‰€ä»¥çƒçš„è§†è§’åˆ†ä¸¤ç§æƒ…å†µï¼š
1ã€ç¬¬ä¸€ä¸ªçƒå¯ä»¥ä¸è£…è¿›ç›’å­ï¼Œè¿™æ ·çš„è¯ä½ å°±éœ€è¦å°†å‰©ä¸‹ n - 1 ä¸ªçƒæ”¾å…¥ k ä¸ªç›’å­ã€‚
2ã€ç¬¬ä¸€ä¸ªçƒå¯ä»¥è£…è¿›ç›’å­ï¼Œè¿™æ ·çš„è¯ä½ å°±éœ€è¦å°†å‰©ä¸‹ n - 1 ä¸ªçƒæ”¾å…¥ k - 1 ä¸ªç›’å­ã€‚
ç»“åˆä¸Šè¿°ä¸¤ç§æƒ…å†µï¼Œå¯ä»¥å¾—åˆ°ï¼š
æ³¨æ„ç»„åˆå’Œå‰é¢æ’åˆ—çš„åŒºåˆ«ï¼Œå› ä¸ºç»„åˆä¸è€ƒè™‘é¡ºåºï¼Œæ‰€ä»¥çƒé€‰æ‹©è£…è¿›ç›’å­æ—¶ï¼Œåªæœ‰ä¸€ç§é€‰æ‹©ï¼Œè€Œä¸æ˜¯ k ç§ä¸åŒé€‰æ‹©ï¼Œæ‰€ä»¥ C(n-1, k-1) ä¸ç”¨ä¹˜ kã€‚ï¼‰
"""


"""
âœ… ä»€ä¹ˆæ˜¯ @lru_cache(None)ï¼Ÿ

å®ƒæ˜¯ Python æ ‡å‡†åº“ functools ä¸­çš„è£…é¥°å™¨ï¼Œç”¨äºè‡ªåŠ¨ä¸ºé€’å½’å‡½æ•°åŠ ä¸Šç¼“å­˜åŠŸèƒ½ï¼ˆè®°å¿†åŒ–ï¼‰ã€‚

å®Œæ•´å†™æ³•ï¼š

from functools import lru_cache

@lru_cache(None)  # None è¡¨ç¤ºç¼“å­˜æ— é™å¤§
def dp(i, j):
    ...

å®ƒçš„ä½œç”¨è·Ÿä½ æ‰‹åŠ¨å†™ self.memo = {} ç±»ä¼¼ï¼Œä½†æ›´å¹²å‡€ä¼˜é›…ã€‚
"""

class Solution:
    """
    âœ… è§£æ³•ä¸€ï¼šé€’å½’ + è®°å¿†åŒ–ï¼ˆä» t çš„è§’åº¦å‡ºå‘ï¼‰
    ğŸ“Œ æ€è·¯æ¦‚è¿°ï¼ˆä½ è¯´çš„è§†è§’ä¸€ï¼‰ï¼š
    æˆ‘ä»¬ä» t[j] å‡ºå‘ï¼Œåœ¨ s[i:] ä¸­æ‰¾åˆ°æ‰€æœ‰ç­‰äº t[j] çš„ä½ç½® kï¼Œç„¶åä» s[k+1:] åŒ¹é… t[j+1:]ã€‚
    """
    def numDistinct(self, s: str, t: str) -> int:
        from functools import lru_cache

        n, m = len(s), len(t)

        @lru_cache(None)
        def dp(i, j):
            # t åŒ¹é…å®Œäº†
            # è¡¨ç¤ºè¿™ä¸ªè·¯å¾„æ˜¯ä¸€ä¸ªåˆæ³•çš„å®Œæ•´åŒ¹é…ï¼Œä¸ºæ•´ä¸ªæ–¹æ¡ˆæ•° +1ã€‚
            if j == m:
                return 1
            # s åŒ¹é…å®Œäº†ä½† t è¿˜æ²¡
            if i == n:
                return 0
            # æå‰å‰ªæ
            # # base case 2
            # if len(s) - i < len(t) - j:
            #     return 0

            res = 0
            for k in range(i, n):
                if s[k] == t[j]:
                    res += dp(k + 1, j + 1)
            return res

        return dp(0, 0)

    """
    âœ… è§£æ³•äºŒï¼šè‡ªé¡¶å‘ä¸‹ï¼ˆä» s çš„è§’åº¦ç©·ä¸¾ï¼Œå¸¦è®°å¿†åŒ–ï¼‰
    ğŸ“Œ æ€è·¯æ¦‚è¿°ï¼ˆä½ è¯´çš„è§†è§’äºŒï¼‰ï¼š
    æšä¸¾æ¯ä¸ª s[i] æ˜¯ä¸æ˜¯è¦åŒ¹é…å½“å‰çš„ t[j]ï¼š
        ä¸åŒ¹é…ï¼šdp(i+1, j)
        åŒ¹é…ï¼šdp(i+1, j+1)
    """
    def numDistinct(self, s: str, t: str) -> int:
        from functools import lru_cache
        n, m = len(s), len(t)

        @lru_cache(None)
        def dp(i, j):
            if j == m: return 1  # t åŒ¹é…å®Œäº†
            if i == n: return 0  # s åŒ¹é…å®Œäº†ä½† t è¿˜æ²¡

            if s[i] == t[j]:
                # ä¸¤ç§é€‰æ‹©ï¼šåŒ¹é… or è·³è¿‡
                return dp(i+1, j+1) + dp(i+1, j)
            else:
                # è·³è¿‡ s[i]
                return dp(i+1, j)

        return dp(0, 0)

    """
    âœ… è‡ªåº•å‘ä¸Š dp
    å’Œé€’å½’å†™æ³•ä¸€ä¸€å¯¹åº”ï¼š
        å¦‚æœ s[i-1] == t[j-1]ï¼Œæˆ‘ä»¬æœ‰ä¸¤ç§é€‰æ‹©ï¼š
            åŒ¹é…å®ƒï¼šdp[i-1][j-1]
            ä¸åŒ¹é…å®ƒï¼šdp[i-1][j]
        æ‰€ä»¥ï¼š
            dp[i][j] = dp[iâˆ’1][jâˆ’1] + dp[iâˆ’1][j]
            dp[i][j] = dp[iâˆ’1][jâˆ’1] + dp[iâˆ’1][j]

        å¦‚æœ s[i-1] != t[j-1]ï¼Œæˆ‘ä»¬åªèƒ½è·³è¿‡å½“å‰å­—ç¬¦ï¼š
            dp[i][j] = dp[iâˆ’1][j]
            dp[i][j] = dp[iâˆ’1][j]
    åˆå§‹åŒ–
        dp[0][0] = 1ï¼šç©ºä¸²åŒ¹é…ç©ºä¸²
        dp[i][0] = 1ï¼šä»»ä½•å‰ç¼€çš„ s éƒ½èƒ½åŒ¹é…ç©ºçš„ tï¼ˆåªæœ‰ä¸€ç§æ–¹æ³•ï¼‰
        dp[0][j > 0] = 0ï¼šç©ºçš„ s æ— æ³•åŒ¹é…éç©ºçš„ t
    """
    def numDistinct(self, s: str, t: str) -> int:
        n, m = len(s), len(t)
        dp = [[0] * (m + 1) for _ in range(n + 1)]

        for i in range(n + 1):
            dp[i][0] = 1  # ç©ºä¸² t åŒ¹é…æ–¹å¼æ˜¯ 1

        for i in range(1, n + 1):
            for j in range(1, m + 1):
                if s[i - 1] == t[j - 1]:
                    dp[i][j] = dp[i - 1][j - 1] + dp[i - 1][j]
                else:
                    dp[i][j] = dp[i - 1][j]

        return dp[n][m]
    
    """
    âœ… äº”ã€ç©ºé—´ä¼˜åŒ–åˆ°ä¸€ç»´ï¼ˆæ»šåŠ¨æ•°ç»„ï¼‰
    å› ä¸ºçŠ¶æ€åªä¾èµ–äºä¸Šä¸€è¡Œï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥ç”¨ä¸€ç»´æ•°ç»„ï¼Œä»å³å¾€å·¦æ›´æ–°é¿å…è¦†ç›–ï¼š
    """
    def numDistinct(self, s: str, t: str) -> int:
        n, m = len(s), len(t)
        dp = [0] * (m + 1)
        dp[0] = 1

        for i in range(1, n + 1):
            # æ³¨æ„å€’åºæ›´æ–°
            for j in range(m, 0, -1):
                if s[i - 1] == t[j - 1]:
                    dp[j] += dp[j - 1]

        return dp[m]


# @lc code=start
class Solution:
    def numDistinct(self, s: str, t: str) -> int:
        # åˆå§‹åŒ–å¤‡å¿˜å½•ä¸ºç‰¹æ®Šå€¼ -1
        self.memo = {}
        return self.dp(s, 0, t, 0)
    
    def dp(self, s, i ,t, j):
        m, n =len(s), len(t)
        # tå®Œå…¨åŒ¹é…ï¼Œæ–¹æ¡ˆæ•°é‡+1
        if j == n:
            return 1
        # sçš„é•¿åº¦ä¸å¤ŸåŒ¹é…täº†/sèµ°å®Œäº†ï¼Œtæ²¡å®Œå…¨åŒ¹é…
        # æ²¡æˆåŠŸï¼Œ+0
        # if i == m:
        if m-i<n-j:
            return 0
        """ æŸ¥å¤‡å¿˜å½•é˜²æ­¢å†—ä½™è®¡ç®— """
        if (i, j) in self.memo:
            return self.memo[(i, j)]
        res = 0
        # é€’å½’
        # ä¸€ä¸ªä½ç½®ä¸€ä¸ªä½ç½®è½®ç€æ‰¾ï¼Œå¦‚æœç¬¬ä¸€ä½åŒ¹é…ï¼Œå°±å¾€åä¸€ä¸ªä¸€ä¸ªåŒ¹é…
        # å¯¹æ¯”å°çƒçš„ï¼šforå¾ªç¯=é€‰å‡ºç¬¬ä¸€ä¸ªçƒï¼ˆnç§ï¼‰ï¼Œåªæ˜¯è¿™é‡Œæœ‰é¡ºåºè¦æ±‚ï¼Œnè½¬æ¢ä¸ºforå¾ªç¯+åˆ¤æ–­é¦–å­—ç¬¦ç›¸åŒ
        for k in range(i, len(s)):
            if s[i] == t[j]:
                # ç¬¬ä¸€ä¸ªçƒå…¥ç›’ï¼Œå¼€å§‹æ‰¾ä¸‹ä¸€ä½ï¼Œè¿™é‡Œç”¨åˆ°é€’å½’è°ƒç”¨
                res += self.dp(s, i+1, t, j+1)
        self.memo[(i, j)] =res
        return res


    def dp(self, s, i ,t, j):
        m, n =len(s), len(t)
        # tå®Œå…¨åŒ¹é…ï¼Œæ–¹æ¡ˆæ•°é‡+1
        if j == n:
            return 1
        # sçš„é•¿åº¦ä¸å¤ŸåŒ¹é…täº†/sèµ°å®Œäº†ï¼Œtæ²¡å®Œå…¨åŒ¹é…
        # æ²¡æˆåŠŸï¼Œ+0
        # if i == m:
        if m-i<n-j:
            return 0
        """ æŸ¥å¤‡å¿˜å½•é˜²æ­¢å†—ä½™è®¡ç®— """
        if (i, j) in self.memo:
            return self.memo[(i, j)]
        res = 0
        # é€’å½’
        # å¯¹åº”ç¬¬äºŒç§æ–¹å¼ï¼Œçƒçš„è§†è§’ï¼Œç¬¬ä¸€ä¸ªçƒï¼ˆsï¼‰å¯å…¥ç›’(t)ï¼Œåˆ™æ‰¾å‰©ä½™ï¼Œä¹Ÿå¯ä¸å…¥ç›’ï¼Œåˆ™åœ¨å‰©ä½™é‡Œé‡æ–°æ‰¾
        # 1. å…¥ç›’ï¼Œp(n-1ï¼Œk-1)*k è¿™é‡Œkå³éå†sæ£€æµ‹æ‰€æœ‰å¯å…¥ç›’s[i] == t[j]çš„ä½ç½®
        # 2. ä¸å…¥ç›’ï¼Œå‰©ä¸‹ n - 1 ä¸ªçƒæ”¾å…¥ k ä¸ªç›’å­ã€‚sçš„ä½ç½®+1
        # æ³¨æ„ï¼šç¬¬ä¸€ä¸ªçƒå¯å…¥ç›’ï¼Œåœ¨æ­¤å¤„å°±æ˜¯åˆ¤æ–­é¦–å­—ç¬¦ç›¸åŒ
        if s[i] == t[j]:
            #             å…¥ç›’                 ä¸å…¥ç›’
            res = self.dp(s, i+1, t, j+1) + self.dp(s, i+1, t, j)
        ##æ³¨æ„è¿™é‡Œ
        else:
            res = self.dp(s, i+1, t, j)
        self.memo[(i, j)] =res
        return res

# @lc code=end



#
# @lcpr case=start
# "rabbbit"\n"rabbit"\n
# @lcpr case=end

# @lcpr case=start
# "babgbag"\n"bag"\n
# @lcpr case=end

#

